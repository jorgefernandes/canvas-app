<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PDF com Pinch Zoom</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        #pdf-container {
            touch-action: none;
            /* Evita interferência com o zoom padrão */
            overflow: auto;
            width: 100%;
            height: 90vh;
            position: relative;
        }

        canvas {
            transform-origin: 0 0;
            /* Mantém o ponto de origem no canto superior esquerdo */
        }
    </style>
</head>

<body>
    <h2>PDF com Pinch Zoom</h2>
    <div id="pdf-container"></div>

    <script>
        var url = 'images/Nubank_2025-02-10.pdf'; // Caminho do PDF
        var pdfContainer = document.getElementById("pdf-container");
        var scaleFactor = 1; // Fator de escala inicial
        var startDistance = 0; // Distância inicial dos dedos

        // Carregar o PDF
        pdfjsLib.getDocument(url).promise.then(function (pdf) {
            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                pdf.getPage(pageNum).then(function (page) {
                    var canvas = document.createElement("canvas");
                    pdfContainer.appendChild(canvas);
                    var context = canvas.getContext("2d");
                    var viewport = page.getViewport({ scale: 1 });

                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    var renderContext = { canvasContext: context, viewport: viewport };
                    page.render(renderContext);
                });
            }
        });

        // Função para calcular a distância entre dois dedos
        function getDistance(event) {
            var dx = event.touches[0].clientX - event.touches[1].clientX;
            var dy = event.touches[0].clientY - event.touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // Evento de toque inicial (pinch start)
        pdfContainer.addEventListener("touchstart", function (event) {
            if (event.touches.length === 2) { // Se houver dois dedos na tela
                startDistance = getDistance(event);
            }
        });

        // Evento de movimento (pinch zoom)
        pdfContainer.addEventListener("touchmove", function (event) {
            if (event.touches.length === 2) {
                var newDistance = getDistance(event);
                var scaleChange = newDistance / startDistance;

                scaleFactor *= scaleChange;
                scaleFactor = Math.max(0.5, Math.min(3, scaleFactor)); // Limita o zoom (0.5x a 3x)

                // Aplicar escala no container do PDF
                pdfContainer.style.transform = `scale(${scaleFactor})`;

                startDistance = newDistance;
                event.preventDefault(); // Evita zoom do navegador
            }
        });
    </script>
</body>

</html>